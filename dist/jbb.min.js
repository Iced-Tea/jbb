/* JBB Binary Bundle Loader - https://github.com/wavesoft/jbb */
var JBBBinaryLoader=function(r){function t(i){if(e[i])return e[i].exports;var s=e[i]={exports:{},id:i,loaded:!1};return r[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var e={};return t.m=r,t.c=e,t.p="",t(0)}([function(r,t,e){"use strict";function i(r,t){var e=r.readStringLT(),i=new Blob([r.readTypedArray(T.UINT8,t)],{type:e});return URL.createObjectURL(i)}function s(r,t,e){var s=0,n="";switch(t){case 0:s=r.u8[r.i8++];break;case 1:s=r.u16[r.i16++];break;case 2:s=r.u32[r.i32++];break;case 3:s=r.f64[r.i64++]}if(0===e)return n=String.fromCharCode.apply(null,r.readTypedArray(T.UINT8,s));if(1===e)return n=String.fromCharCode.apply(null,r.readTypedArray(T.UINT16,s));if(2===e){var a=document.createElement("img");return a.src=i(r,s),a}if(4===e){var a=document.createElement("script");return a.src=i(r,s),a}if(7===e)return i(r,s);throw new b.AssertError("Unknown buffer type #"+e+"!")}function n(r,t,e){if(!(32&e&&32!==(48&e))){var i=e;32&e&&(i=r.u8[r.i8++]|(15&e)<<8);var s=r.profile.decode(i);if(void 0===s)throw new b.AssertError("Could not found known object entity #"+i+"!");var n=s.create();r.iref_table.push(n);var a=l(r,t);return s.init(n,a,1,0),n}if(56!==(60&e)){if(48===(56&e)){var i=(7&e)<<8|r.u8[r.i8++],o=l(r,t),u=r.factory_plain[i];if(void 0===u)throw new b.AssertError("Could not found simple object signature with id #"+i+"!");return u(o)}throw new b.AssertError("Unexpected object opcode 0x"+e.toString(16)+"!")}var h=3&e;switch(h){case 0:var f=r.f64[r.i64++];10*r.s8[r.i8++];return new Date(f);default:throw new b.AssertError("Unknown primitive object with POID #"+h+"!")}}function a(r,t,e,i){for(var s=new _[m.FROM[i]](e),n=r.readTypedNum(m.FROM[i]),a=r.readFloat64(),o=r.readTypedArray(m.TO[i],e),u=0;e>u;++u)s[u]=n+o[u]*a,console.log("<<<",o[u],"->",s[u]);return s}function o(r,t,e,i){var s=A.FROM[i],n=new _[s](e),a=0;switch(s){case 0:a=r.u8[r.i8++];break;case 1:a=r.s8[r.i8++];break;case 2:a=r.u16[r.i16++];break;case 3:a=r.s16[r.i16++];break;case 4:a=r.u32[r.i32++];break;case 5:a=r.s32[r.i32++];break;case 6:a=r.f32[r.i32++];break;case 7:a=r.f64[r.i64++]}var o=r.readTypedArray(A.TO[i],e-1);n[0]=a;for(var u=0,h=o.length;h>u;++u)a+=o[u],n[u+1]=a;return n}function u(r,t){var e=r.u16[r.i16++],i=r.signature_table[e],s=r.factory_plain_bulk[e];if(void 0===s)throw new b.AssertError("Could not found simple object signature with id #"+e+"!");for(var n=l(r,t),a=n.length/i.length,o=new Array(a),u=0;a>u;++u)o[u]=s(n,u);return o}function h(r,t,e){var i=!1,s=r.u16[r.i16++],n=r.profile.decode(s),a=n.props,o=0,u=[],h=0,f=0,c=0,d=null,p=0,v=0,y=[],w=[];for(65536>e?(c=r.u16[r.i16++],i&&console.log("-<- HINT16="+c)):(c=r.u32[r.i32++],i&&console.log("-<- HINT32="+c)),u=Array(c),h=0;c>h;++h)r.iref_table.push(u[h]=n.create());if(c){if(y=l(r,t),void 0===y.length)throw new b.AssertError("Decoded known bulk primitive is not array!");o=y.length/a}var g=new Array(e),T=0,E=void 0;for(h=0;e>h;)if(v=r.u8[r.i8++],(128&v)===I.LREF_7)f=127&v,i&&console.log("-<- LREF_7(",f,"), i=",h),g[h++]=E=w[f];else if((192&v)===I.DEFINE){for(f=(63&v)+1,i&&console.log("-<- DEFINE(",f,"), i=",h),p=0;f>p;p++)d=u[T],n.init(d,y,o,T),g[h++]=d,T++;E=d}else if((224&v)===I.REPEAT)for(f=(31&v)+1,i&&console.log("-<- REPEAT(",f,"), i=",h),p=0;f>p;p++)g[h++]=E;else if((240&v)===I.IREF){if(f=(15&v)<<16|r.u16[r.i16++],i&&console.log("-<- IREF(",f,"), i=",h),f>=r.iref_table.length)throw new b.IRefError("Invalid IREF #"+f+"!");g[h++]=E=r.iref_table[f],w.push(r.iref_table[f])}else if((248&v)===I.LREF_11)f=(7&v)<<8|r.u8[r.i8++],i&&console.log("-<- LREF_11(",f,"), i=",h),g[h++]=E=w[f];else if(v===I.LREF_16)f=r.u16[r.i16++],i&&console.log("-<- LREF_16(",f,"), i=",h),g[h++]=E=w[f];else if(v===I.XREF){if(f=r.readStringLT(),i&&console.log("-<- XREF(",f,"), i=",h),void 0===t[f])throw new b.XRefError("Cannot import undefined external reference "+f+"!");g[h++]=E=t[f]}return g}function f(r,t,e,i){for(var s,n,a=r.u8[r.i8++],o=[],u=0,h=!0,f=0,l=0,d=0,p=0,v=0,y=0;e>u;){if(i)if(64===(240&a)){switch(d=1&a,p=a>>1&7,v=d?r.u32[r.i32++]:r.u16[r.i16++],h&&(n=new _[p](e),h=!1),p){case 0:y=r.u8[r.i8++];break;case 1:y=r.s8[r.i8++];break;case 2:y=r.u16[r.i16++];break;case 3:y=r.s16[r.i16++];break;case 4:y=r.u32[r.i32++];break;case 5:y=r.s32[r.i32++];break;case 6:y=r.f32[r.i32++];break;case 7:y=r.f64[r.i64++]}n.fill(y,u,u+v),u+=v}else{if(s=c(r,t,a),void 0===s.length)throw new b.AssertError("Encountered non-array chunk as part of chunked array!");if(h&&(n=new s.constructor(e),h=!1),!(s instanceof n.constructor))throw new b.AssertError("Got is_numeric flag, but chunks are not of the same type (op was "+a+"!");n.set(s,u),u+=s.length}else{if(s=c(r,t,a),void 0===s.length)throw new b.AssertError("Encountered non-array chunk as part of chunked array!");for(h&&(o=new Array(e),h=!1),f=0,l=s.length;l>f;f++,u++)o[u]=s[f]}if(!(e>u))break;a=r.u8[r.i8++]}return i?n:o}function c(r,t,e){var i,s=0,n=0,c=0,d=0,p=[];if(e=255&e,110===e)return u(r,t);if(111===e){for(d=r.u8[r.i8++],p[d-1]=null,s=0;d>s;++s)p[s]=l(r,t);return p}if(126===e)return[];if(127===e)throw new b.AssertError("Encountered PRIM_CHUNK_END outside of chunked array!");if(0===(224&e)){c=1&e,n=e>>1&15,d=c?r.u32[r.i32++]:r.u16[r.i16++],i=r.readTypedArray(E.TO[n],d);var v=new _[E.FROM[n]](i);return v}if(32===(240&e))return c=1&e,n=e>>1&7,d=c?r.u32[r.i32++]:r.u16[r.i16++],o(r,t,d,n);if(48===(240&e))return c=1&e,n=e>>1&7,d=c?r.u32[r.i32++]:r.u16[r.i16++],a(r,t,d,n);if(64===(240&e)){switch(c=1&e,n=e>>1&7,d=c?r.u32[r.i32++]:r.u16[r.i16++],n){case 0:i=r.u8[r.i8++];break;case 1:i=r.s8[r.i8++];break;case 2:i=r.u16[r.i16++];break;case 3:i=r.s16[r.i16++];break;case 4:i=r.u32[r.i32++];break;case 5:i=r.s32[r.i32++];break;case 6:i=r.f32[r.i32++];break;case 7:i=r.f64[r.i64++]}var v=new _[n](d);for(s=0;d>s;++s)v[s]=i;return v}if(80===(240&e))return c=1&e,n=e>>1&7,d=c?r.u32[r.i32++]:r.u16[r.i16++],p=r.readTypedArray(n,d);if(96===(248&e))return n=7&e,d=r.u8[r.i8++],p=r.readTypedArray(n,d);if(104===(254&e)){for(c=1&e,d=c?r.u32[r.i32++]:r.u16[r.i16++],i=l(r,t),p[d-1]=null,s=0;d>s;s++)p[s]=i;return p}if(106===(254&e)){for(c=1&e,d=c?r.u32[r.i32++]:r.u16[r.i16++],p[d-1]=null,s=0;d>s;++s)p[s]=l(r,t);return p}if(120===(252&e))return c=1&e,n=e>>1&1,d=c?r.u32[r.i32++]:r.u16[r.i16++],f(r,t,d,n);if(124===(254&e))return c=1&e,d=c?r.u32[r.i32++]:r.u16[r.i16++],h(r,t,d);throw new b.AssertError("Unknown array op-code 0x"+e.toString(16)+" at offset @"+(r.i8-r.ofs8)+"!")}function l(r,t){var e=r.u8[r.i8++];if(0===(128&e))return c(r,t,127&e);if(128===(192&e))return n(r,t,63&e);if(192===(224&e))return s(r,(24&e)>>3,7&e);if(224===(240&e)){var i=r.u16[r.i16++];if(i=(15&e)<<16|i,i>=r.iref_table.length)throw new b.IRefError("Invalid IREF #"+i+"!");return r.iref_table[i]}if(240===(248&e))switch(7&e){case 0:return r.u8[r.i8++];case 1:return r.s8[r.i8++];case 2:return r.u16[r.i16++];case 3:return r.s16[r.i16++];case 4:return r.u32[r.i32++];case 5:return r.s32[r.i32++];case 6:return r.f32[r.i32++];case 7:return r.f64[r.i64++]}else{if(248===(252&e))return k[3&e];if(252===(254&e))return F[2&e];if(254===(255&e)){var a=r.readStringLT();if(void 0===t[a])throw new b.XRefError("Cannot import undefined external reference "+a+"!");return t[a]}if(255===(255&e))throw new b.AssertError("Encountered RESERVED primitive operator!")}}function d(r,t){for(;!r.eof();){var e=r.u8[r.i8++];switch(e){case 248:var i=r.prefix+r.readStringLT();t[i]=l(r,t);break;default:throw new b.AssertError("Unknown control operator 0x"+e.toString(16)+" at @"+r.i8+"!")}}}function p(r,t){var e=r.length,i=Array(e),s=!1;return r.forEach(function(n,a){var o=new XMLHttpRequest;o.open("GET",r[a]),o.responseType="arraybuffer",o.send(),o.addEventListener("readystatechange",function(){if(4===o.readyState)if(200===o.status)i[a]=o.response,0===--e&&t(null);else{if(s)return;t("Error loading "+r[a]+": "+o.statusText),s=!0}})}),i}var v=e(1),y=e(2),b=e(3),w=0,g=1,T={UINT8:0,INT8:1,UINT16:2,INT16:3,UINT32:4,INT32:5,FLOAT32:6,FLOAT64:7},E={FROM:[T.UINT16,T.INT16,T.UINT32,T.INT32,T.UINT32,T.INT32,T.FLOAT32,T.FLOAT32,T.FLOAT32,T.FLOAT32,T.FLOAT64,T.FLOAT64,T.FLOAT64,T.FLOAT64,T.FLOAT64],TO:[T.UINT8,T.INT8,T.UINT8,T.INT8,T.UINT16,T.INT16,T.UINT8,T.INT8,T.UINT16,T.INT16,T.UINT8,T.INT8,T.UINT16,T.INT16,T.FLOAT32]},A={FROM:[T.UINT16,T.INT16,T.UINT32,T.INT32,T.UINT32,T.INT32],TO:[T.INT8,T.INT8,T.INT8,T.INT8,T.INT16,T.INT16]},m={FROM:[T.FLOAT32,T.FLOAT32,T.FLOAT64,T.FLOAT64],TO:[T.INT8,T.INT16,T.INT8,T.INT16]},_=[Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Float32Array,Float64Array],I=([T.UINT16,T.UINT32],[T.UINT8,T.UINT16,T.UINT32,T.FLOAT64],{LREF_7:0,LREF_11:240,LREF_16:254,IREF:224,XREF:255,DEFINE:128,REPEAT:192}),k=[void 0,null,!1,!0],F=[NaN],N=function(r,t){"object"==typeof r&&(t=r,r=""),this.database=t||{},this.baseDir=r||"",this.queuedRequests=[],this.profile=new y,this.__delayGC=[]};N.prototype={constructor:N,addProfile:function(r){this.profile.add(r)},add:function(r,t){if(0===this.profile._lib.length)throw new b.AssertError("You must first add a profile!");var e="";this.baseDir&&(e=this.baseDir+"/");var i=r.split("?"),s="",n=[];if(i.length>1&&(s="?"+i[1]),".jbbp"===i[0].substr(i[0].length-5).toLowerCase()){var a=e+i[0].substr(0,i[0].length-5);n=[a+".jbbp"+s,a+"_b16.jbbp"+s,a+"_b32.jbbp"+s,a+"_b64.jbbp"+s]}else{var r=i[0];".jbb"!=r.substr(r.length-4)&&(r+=".jbb"),n=[e+r+s]}var o={callback:t,status:w,buffer:void 0,url:n};this.queuedRequests.push(o)},addByBuffer:function(r){var t={callback:void 0,status:g,buffer:r,url:void 0};this.queuedRequests.push(t)},load:function(r){this.__process(r)},__process:function(r){var t=this;if(r||(r=function(){}),0===this.queuedRequests.length)return void r(null,this.database);for(var e=!1,i=0;i<this.queuedRequests.length;++i)if(this.queuedRequests[i].status===w){e=!0;break}if(e)for(var s={counter:0},n=function(){0===--this.counter&&t.__process(r)}.bind(s),a=!1,i=0;i<this.queuedRequests.length;++i){var o=this.queuedRequests[i];o.status===w&&(s.counter++,o.buffer=p(o.url,function(t){return function(e){if(e){if(a)return;var i="Error downloading bundle: "+e;return t.callback&&t.callback(i,null),r&&r(i,null),void(a=!0)}t.status=g,n()}}(o)))}else{for(var i=0;i<this.queuedRequests.length;++i){var o=this.queuedRequests[i];if(o.status===g){var u;u=1===o.buffer.length?new v(o.buffer[0],t.profile):new v(o.buffer,t.profile),d(u,t.database),o.callback&&o.callback(null,o.bundle)}}this.queuedRequests=[],r(null,this.database),setTimeout(function(){this.__delayGC=[]}.bind(this),500)}}},r.exports=N},function(r,t){"use strict";function e(r){for(var t="",e=0;r>e;++e)0!==e&&(t+=","),t+="p[i+c*"+e+"]";return new Function("p","i","var c=p.length/"+r+";return ["+t+"]")}var i=function(r,t){this.profile=t,this.prefix="",this.sparse=r instanceof Array;var i,s,n,a=32;if(this.sparse?(this.u8=new Uint8Array(r[0]),this.s8=new Int8Array(r[0]),this.u16=new Uint16Array(r[1]),this.s16=new Int16Array(r[1]),this.u32=new Uint32Array(r[2]),this.s32=new Int32Array(r[2]),this.f32=new Float32Array(r[2]),this.f64=new Float64Array(r[3]),i=new Uint16Array(r[0],0,a/2),s=new Uint32Array(r[0],0,a/4),n=r[0].byteLength):(this.u8=new Uint8Array(r),this.s8=new Int8Array(r),this.u16=new Uint16Array(r),this.s16=new Int16Array(r),this.u32=new Uint32Array(r),this.s32=new Int32Array(r),this.f32=new Float32Array(r),this.f64=new Float64Array(r),i=new Uint16Array(r),s=new Uint32Array(r),n=r.byteLength),this.magic=i[0],this.table_id=i[1],this.version=i[2],this.table_count=i[3],this.ver_major=255&this.version,this.ver_minor=(65280&this.version)>>8,this.max64=s[2],this.max32=s[3],this.max16=s[4],this.max8=s[5],this.lenST=s[6],this.lenOT=s[7],12610==this.magic)throw{name:"EndianessError",message:"Unfortunately the JBB format is currently only compatible with Little-Endian CPUs",toString:function(){return this.name+": "+this.message}};if(16945!=this.magic)throw{name:"DecodingError",message:"This does not look like a JBB archive! (Magic is 0x"+this.magic.toString(16)+")",toString:function(){return this.name+": "+this.message}};if(258!=this.version)throw{name:"DecodingError",message:"Unsupported bundle version v"+this.ver_minor+"."+this.ver_minor,toString:function(){return this.name+": "+this.message}};this.sparse?(this.i64=0,this.i32=0,this.i16=0,this.i8=a,this.iEnd=this.i8+this.max8-this.lenST,this.ofs8=this.i8,this.ofs16=this.i16,this.ofs32=this.i32,this.ofs64=this.i64):(this.i64=a,this.i32=this.i64+this.max64,this.i16=this.i32+this.max32,this.i8=this.i16+this.max16,this.iEnd=this.i8+this.max8-this.lenST,this.ofs8=this.i8,this.ofs16=this.i16,this.ofs32=this.i32,this.ofs64=this.i64,this.i16/=2,this.i32/=4,this.i64/=8);var o=[];if(this.table_count<=1)o.push(this.table_id);else{if(0!==this.table_id)throw{name:"DecodingError",message:"Invalid header data",toString:function(){return this.name+": "+this.message}};for(var u=0;u<this.table_count;++u)o.push(this.u16[this.i16++])}this.profile.use(o),this.iref_table=[];var h="",f=!1;if(this.string_table=[],this.lenST>0){for(var c=this.i8+this.max8,u=c-this.lenST;c>u;++u){var l=this.u8[u];0===l?(this.string_table.push(h),h="",f=!1):(h+=String.fromCharCode(l),f=!0)}f&&this.string_table.push(h)}var d=[],p=0,v=!1;if(this.signature_table=[],this.lenOT>0){for(var c=2*this.i16+this.max16,u=c-this.lenOT;c>u;u+=2){var l=this.u16[u/2];p--?d.push(this.string_table[l]):(v&&this.signature_table.push(d),d=[],p=l,v=!0)}v&&this.signature_table.push(d)}this.sparse?this.readTypedArray=function(t,e){var i=this.i8,s=2*this.i16,n=4*this.i32,a=8*this.i64;switch(t){case 0:return this.i8+=e,new Uint8Array(r[0],i,e);case 1:return this.i8+=e,new Int8Array(r[0],i,e);case 2:return this.i16+=e,new Uint16Array(r[1],s,e);case 3:return this.i16+=e,new Int16Array(r[1],s,e);case 4:return this.i32+=e,new Uint32Array(r[2],n,e);case 5:return this.i32+=e,new Int32Array(r[2],n,e);case 6:return this.i32+=e,new Float32Array(r[2],n,e);case 7:return this.i64+=e,new Float64Array(r[3],a,e)}}:this.readTypedArray=function(t,e){var i=this.i8,s=2*this.i16,n=4*this.i32,a=8*this.i64;switch(t){case 0:return this.i8+=e,new Uint8Array(r,i,e);case 1:return this.i8+=e,new Int8Array(r,i,e);case 2:return this.i16+=e,new Uint16Array(r,s,e);case 3:return this.i16+=e,new Int16Array(r,s,e);case 4:return this.i32+=e,new Uint32Array(r,n,e);case 5:return this.i32+=e,new Int32Array(r,n,e);case 6:return this.i32+=e,new Float32Array(r,n,e);case 7:return this.i64+=e,new Float64Array(r,a,e)}},this.factory_plain=[],this.factory_plain_bulk=[];for(var u=0;u<this.signature_table.length;++u){for(var y=this.signature_table[u],b=y.length,w="return {",g="var c=values.length/"+b+";"+w,T=0;b>T;++T)w+="'"+y[T]+"': values["+T+"],",g+="'"+y[T]+"': values[i+c*"+T+"],";w+="}",g+="}",this.factory_plain.push(new Function("values",w)),this.factory_plain_bulk.push(new Function("values","i",g))}this.factory_weave=[function(r,t){return[]}];for(var u=1;16>u;++u)this.factory_weave.push(e(u))};i.prototype.getWeavePropertyFunction=function(r){return void 0!==this.factory_weave[r]?this.factory_weave[r]:(this.factory_weave[r]=e(r),this.factory_weave[r])},i.prototype.readStringLT=function(){var r=this.u16[this.i16++];if(r>=this.string_table.length)throw{name:"RangeError",message:"String ID is outside than the range of the string lookup table!",toString:function(){return this.name+": "+this.message}};return this.string_table[r]},i.prototype.eof=function(){return this.i8>=this.iEnd},i.prototype.where=function(){console.log("i8=",this.i8-this.ofs8," [U:",this.u8[this.i8],"0x"+this.u8[this.i8].toString(16),"/ S:",this.s8[this.i8],"]"),console.log("i16=",this.i16-this.ofs16/2," [U:",this.u16[this.i16],"/ S:",this.s16[this.i16],"]"),console.log("i32=",this.i32-this.ofs32/4," [U:",this.u32[this.i32],"/ S:",this.s32[this.i32],"/ F:",this.f32[this.i32],"]"),console.log("i64=",this.i64-this.ofs64/8," [F:",this.f64[this.i64],"]")},r.exports=i},function(r,t){"use strict";var e=function(){this.size=0,this._lib=[],this._profiles=[],this._offset=0,this._foffset=0};e.prototype.add=function(r){this._lib.push(r)},e.prototype.use=function(r){for(var t=0,e=r.length;e>t;t++){for(var i=null,s=r[t],n=0,a=this._lib.length;a>n;n++){var o=this._lib[n];if(o.id===s){i=o;break}}if(null===i){var u=(65520&s)>>4,h=15&s;throw{name:"DecodingError",message:"The bundle uses profile 0x"+u.toString(16)+", rev "+h+" but it was not loaded!",toString:function(){return this.name+": "+this.message}}}this.size+=i.size,this._profiles.push([i,this._foffset,this._foffset+i.frequent,this._offset,this._offset+i.size-i.frequent]),this._offset+=i.size-i.frequent,this._foffset+=i.frequent}},e.prototype.decode=function(r){if(32>r)for(var t=0,e=this._profiles.length;e>t;++t){var i=this._profiles[t],s=i[0],n=i[1],a=i[2];if(r>=n&&a>r)return s.decode(r-n)}else{r-=32;for(var t=0,e=this._profiles.length;e>t;++t){var i=this._profiles[t],s=i[0],n=i[3],a=i[4];if(r>=n&&a>r)return s.decode(r-n+32)}}},r.exports=e},function(r,t){"use strict";var e=function(r){var t=Error.call(this,r);t.name=this.name="EncodeError",this.stack=t.stack,this.message=t.message};e.prototype=Object.create(Error.prototype);var i=function(r){var t=Error.call(this,r);t.name=this.name="AssertError",this.stack=t.stack,this.message=t.message};i.prototype=Object.create(Error.prototype);var s=function(r){var t=Error.call(this,r);t.name=this.name="PackError",this.stack=t.stack,this.message=t.message};s.prototype=Object.create(Error.prototype);var n=function(r){var t=Error.call(this,r);t.name=this.name="RangeError",this.stack=t.stack,this.message=t.message};n.prototype=Object.create(Error.prototype);var a=function(r){var t=Error.call(this,r);t.name=this.name="IRefError",this.stack=t.stack,this.message=t.message};a.prototype=Object.create(Error.prototype);var o=function(r){var t=Error.call(this,r);t.name=this.name="XRefError",this.stack=t.stack,this.message=t.message};o.prototype=Object.create(Error.prototype),r.exports={EncodeError:e,AssertError:i,PackError:s,RangeError:n,IRefError:a,XRefError:o}}]);